{
  "variables": {
    "project_id": "{{env `PROJECT_ID`}}",
    "gcr_prefix": "{{env `GCR_PREFIX`}}"
  },
  "builders" : [
    {
    "type": "googlecompute",
    "project_id": "{{user `project_id`}}",
    "source_image": "debian-8-jessie-v20160418",
    "zone": "us-central1-f",
    "image_name" : "guestbook-image",
    "disk_size" : 10,
    "machine_type" : "n1-standard-2",
    "network" : "default",
    "tags" : ["ssh"]
    }
  ],
  "provisioners" : [
    {
    "type": "shell",
    "inline": [
      "apt-get purge lxc-docker*",
      "apt-get purge docker.io*",
      "apt-get update",
      "apt-get -y -qq install apt-transport-https ca-certificates",
      "apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D",
      "echo deb https://apt.dockerproject.org/repo debian-jessie main >> /etc/apt/sources.list.d/docker.list",
      "apt-get update",
      "apt-cache policy docker-engine",
      "apt-get -y -qq install docker-engine",
      "service docker start",
      "gcloud -q components update",
      "gcloud docker pull {{user `gcr_prefix`}}/{{user `project_id`}}/guestbook"
      ]
    }
  ]
}
